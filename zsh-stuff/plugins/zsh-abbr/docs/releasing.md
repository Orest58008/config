# Releasing

The process for cutting new releases.

1. Checkout `main`
1. Run
    ```shell
    conventional-changelog -p angular -i CHANGELOG.md -s
    ```
    Requires [conventional-changelog-cli](https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-cli)
1. Update `./man/man1/abbr.1`: bump date and version at top.
1. Update `./zsh-abbr.zsh`: bump date at top, and version at top and in `_abbr()`
1. Commit with message (replacing `<VERSION>` with the version)
    ```
    chore(bump): bump to v<VERSION>, update changelog
    ```
1. Tag the release. Run (replacing `<TAG>` with the tag, `v`-prefixed semver)
    ```shell
    git tagit <TAG>
    ```
1. Update overall trunk branches. Run
    ```shell
    git push
    git checkout master
    git merge main
    git push
    ```
1. Update the appropriate version trunk branch. Run for example (before the v5 release)
    ```shell
    git checkout v4
    git merge main
    git push
    ```
1. If appropriate, update other version trunks.
    - If the change is made in v4, run
        ```shell
        git checkout v5
        git merge --no-ff v4
        git checkout --ours .
        git checkout v4 -- <relevant files>
        # manually copy over v4 CHANGELOG change into v5, marking it as "From v4.â€¦"
        git commit
        git push
        ```
1. Push the tag. Run (replacing `<TAG>` with the tag)
    ```shell
    git push origin <TAG>
    ```
1. On GitHub cut a new release at the tag. Use the form of existing release notes, replacing the version number, SHA, and CHANGELOG URL. Attach the release binary generated by `git-tagit`.
1. If the change is to a prerelease, update the Homebrew formula's HEAD branch. Run
    ```shell
    git checkout next
    git merge <VERSION TRUNK BRANCH> # e.g. git merge v5
    ```
1. Update Homebrew:
    - If the change is _not_ a prerelease, and bumps the stable version, update [the stable version Homebrew formula](https://github.com/olets/homebrew-tap/blob/main/zsh-abbr.rb):
        - update the `url` with the new version number
        - update the `sha256` with the binary's SHA
    - If the change is _not_ a prerelease, and bumps v4, update [the v4.x Homebrew formula](https://github.com/olets/homebrew-tap/blob/main/zsh-abbr%404.rb):
        - update the `url` with the new version number
        - update the `sha256` with the binary's SHA
